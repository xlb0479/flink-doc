# 容错与状态快照

## 状态后端（State Backend）

Flink托管的带key状态（keyed state）是一种分片化的kv存储，被用到的部分会本地化存储在taskmanager本地。算子状态同样保存在使用者机器本地。

Flink托管的状态是存储在*状态后端（state backend）* 中的。状态后端有两种实现，一种是基于RocksDB，嵌入式的kv存储，将状态保存在磁盘中，另一种是基于堆的状态后端，将状态保存在Java堆中。

<table>
<tr><th style="background-color: #eff8ff;">名称</th><th style="background-color: #eff8ff;">存储位置</th><th style="background-color: #eff8ff;">快照</th></tr>
<tr><td><b>EmbeddedRocksDBStateBackend</b></td><td>本地磁盘（临时目录）</td><td>全量/增量</td></tr>
<tr><td colspan="3"><ul><li>支持大于可用内存的状态</li><li>注意：比基于堆的后端慢10倍</li></ul>
</td></tr>
<tr><td><b>HashMapStateBackend</b></td><td>JVM堆</td><td>全量</td></tr>
<tr><td colspan="3"><ul><li>速度快，需要大堆</li><li>受GC控制</li></ul>
</td></tr>
</table>

